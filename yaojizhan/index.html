<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" type="text/css" href="css/base.css"/>
<style>
body {
  margin: 0px;
  padding: 0px;
  width: 100%;
  height: 100%;
}
img, a img {
  border: 0;
}
.search-box {
  position: fixed;
  right: 0;
  border: 1px solid #ccc;
  width: 200px;
  height: 50px;
  z-index: 9999;
  background-color: white;
}

  #project-label {
    display: block;
    font-weight: bold;
    /*margin-bottom: 1em;*/
  }
  #project-icon {
    float: left;
    height: 32px;
    width: 32px;
  }
  #project-description {
    margin: 0;
    padding: 0;
  }

</style>
<script type="text/javascript">
//预处理
(function () {
    var i, arr;

    if (!window.console) {
        window.console = {};
    }

    // union of Chrome, FF, IE, and Safari console methods
    arr = [
        "log", "info", "warn", "error", "debug", "trace", "dir", "group",
        "groupCollapsed", "groupEnd", "time", "timeEnd", "profile", "profileEnd",
        "dirxml", "assert", "count", "markTimeline", "timeStamp", "clear"
    ];

    // define undefined methods as noops to prevent errors
    for (i = 0; i < arr.length; i++) {

        if (!window.console[arr[i]]) {
            window.console[arr[i]] = function () {};
        }
    }

    try {
        window.$ = jQuery;
        console.log("替换完成 $");
    } catch (e) {
        console.log("替换失败");
    }
}());
</script>
</head>
<body>
<div class="search-box">
  <div id="project-label">搜索展厅</div>
  <img id="project-icon" src="images/transparent_1x1.png" class="ui-state-default" alt="" style="display: none;">
  <input id="project">
  <input type="hidden" id="project-id">
  <p id="project-description"></p>
</div>
<div id="container" class="main-area">
  <div id="pic-show-area" class="img-container" >
    <div class="mod-pic-show">
      <img src="0.jpg" data-id="0" width="100%" usemap="#planetmap" style="display:block;">
    </div>
  </div>
  <span class="img-prev" href="javascript:void(0);" target="_blank" hidefocus="true"  ondragstart="return false;"><span class="img-switch-btn"></span></span>
  <span class="img-next" href="javascript:void(0);" target="_blank" hidefocus="true"  ondragstart="return false;"><span class="img-switch-btn"></span></span>
</div>
<div style="position:absolute;top:94%;left:1%;font-size:15px;font-family:'宋体';font-weight:normal;color:#FFFFFF;"><p>京ICP备14058628号</p></div>
<map name="planetmap" id="map">
<!--
    <area shape="poly" coords="155,270,230,170,380,190,395,270,360,355,180,355" href="#" alt="Sun">
    <area shape="poly" coords="15,485,80,385,303,370,330,457,290,556,50,555" href="#" alt="Venus">
    <area shape="rect" coords="605,195,785,295" href="#" alt="Mercury">
    <area shape="rect" coords="590,305,790,420" href="#" alt="Mercury">
    <area shape="rect" coords="580,440,820,590" href="#" alt="Mercury">
    <area shape="poly" coords="870,300,930,490,1340,490,1220,300,1060,250" href="#" alt="Sun">
-->
</map>
<script type="text/javascript" src="lib/jquery.js" ></script>

<!--<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>-->
<link rel="stylesheet" href="//libs.baidu.com/jqueryui/1.8.22/themes/smoothness/jquery-ui.css">
<script src="//libs.baidu.com/jqueryui/1.8.22/jquery-ui.min.js"></script>

<script type="text/javascript" src="data.js" ></script>
<script type="text/javascript">

// ???
var pre;

$(function() {

  $(".img-prev").click(function() {
    var img = $(".mod-pic-show img");
    var current_id, next_id;

    current_id = parseInt(img.data("id"));
    console.log("Current image id is: " + current_id);

    next_id = current_id - 1;
    console.log("Next image id is: " + next_id);

    img.trigger("imagechange", [next_id]);
  });

  $(".img-next").click(function() {
    var img = $(".mod-pic-show img");
    var current_id, next_id;

    current_id = parseInt(img.data("id"));
    console.log("Current image id is: " + current_id);

    next_id = current_id + 1;
    console.log("Next image id is: " + next_id);

    img.trigger("imagechange", [next_id]);
  });

  $(".mod-pic-show img").bind("imagechange", function (event, id) {
    console.log("[Event] Event name: imagechange");
    console.log("[Event] Change to image id: " + id);
    $(this).data("id", id);
    $(this).fadeOut(250).attr("src", id+".jpg").fadeIn(250);
    load_map_data( DATA[id] );
    if ( id == 0 )
    {
      $(".img-prev").hide();
      $(".img-next").show();
    }
    else if ( id == 2 )
    {
      $(".img-prev").show();
      $(".img-next").hide();
    }
    else
    {
      $(".img-prev").show();
      $(".img-next").show();
    }
  });

});

$(function(){
  var width = $(document).width();
		/*
        var height = window.innerHeight;
        var prew = width/1366;
        var preh = height/666;
		var pre;
		if(prew > preh){
			pre=preh;
		}else{
			pre=prew;
		}
		*/
	pre = width/1366;
  console.log(width);

  console.log( "Load first item of map array." );
  $(".mod-pic-show img").attr("src", "0.jpg").trigger("imagechange", [0]);
  
  // Set vertical align center.
  var t = setTimeout(function() {
    var window_height = $(document).height();
    var container_height = $("#container").height();
    var container_margin_top = ( window_height - container_height ) / 2;
    $("#container").css("margin-top", container_margin_top + "px");
  }, 500);
});

// Search box
$(function() {
  var projects = [
    {
      value: "jquery",
      label: "jQuery",
      desc: "",
      icon: "",
      url: ""
    },
    {
      value: "jquery-ui",
      label: "jQuery UI",
      desc: "",
      icon: "",
      url: ""
    },
    {
      value: "北京翰林航宇",
      label: "北京翰林航宇科技发展股份有限公司",
      desc: "",
      icon: "",
      url: "../hanlinjinggongzhutiting/index.html"
    }
  ];
  var i, j, item, k, keywords, projects2 = [];
  for (i in DATA) {
    for (j in DATA[i]) {
      item = DATA[i][j];
      keywords = item.keywords.split(" ");
      for (k in keywords) {
        projects2.push({
          value: keywords[k],
          label: item.name,
          desc: "",
          icon: "",
          url: ""
        });
      }
    }
  }

  $( "#project" ).autocomplete({
    minLength: 0,
    source: projects2,
    focus: function( event, ui ) {
      $( "#project" ).val( ui.item.label );
      return false;
    },
    select: function( event, ui ) {
      $( "#project" ).val( ui.item.label );
      $( "#project-id" ).val( ui.item.value );
      //$( "#project-description" ).html( ui.item.desc );
      //$( "#project-icon" ).attr( "src", "images/" + ui.item.icon );
      window.location.href = ui.item.url;

      return false;
    }
  })
  .autocomplete( "instance" )._renderItem = function( ul, item ) {
    return $( "<li>" )
      .append( "<a>" + item.label + "<br>" + item.desc + "</a>" )
      .appendTo( ul );
  };
});

// Load new map data
function load_map_data(map) {
  var out = "", i, hotspot, coords;
  for (i in map) {
    hotspot = map[i];
    coords = map[i]["map"];
    out += '<area shape="' + _get_shape_type(coords) + '" coords="';

    function _get_percentage(coords) {
      var i = 0, size;
      for (i in coords) {
        size = coords[i];
        coords[i] = _calc_client_size(size);
      }
      return coords;
    }
    function _calc_client_size(size) {
      var gimp_image_map_width = 500;
      var window_width = $(document).width();
      return Math.floor(size * (window_width / gimp_image_map_width));
    }
    _get_percentage(coords);
    out += coords.join(",");

    out += '" href="';
    out += hotspot["link"];
    out += '">';
  }

  console.log(out);
  $("#map").html(out).trigger("mapchange");;
}

function _get_shape_type(coords) {
  if(coords.length > 4) {
    return "poly";
  } else {
    return "rect";       
  }
}
</script>
</body>
</html>
